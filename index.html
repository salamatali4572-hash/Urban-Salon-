<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Salon Manager</title>
<style>
body{margin:0;font-family:sans-serif;background:#0b1220;color:#e5e7eb;}
header{display:flex;align-items:center;gap:10px;padding:10px 16px;background:#111;}
header h1{margin:0;font-size:18px;font-weight:700}
.pill{margin-left:auto;padding:4px 10px;background:#7c3aed;border-radius:999px;font-size:12px}
.app{max-width:700px;margin:30px auto;padding:16px}
.card{background:#1e293b;padding:20px;border-radius:14px}
.tabs{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
.tab{flex:1;padding:10px;border-radius:8px;text-align:center;cursor:pointer;background:#334155}
.tab.active{background:#7c3aed;color:#fff}
.hidden{display:none}
label{font-size:12px;display:block;margin:6px 0}
input{width:100%;padding:10px;border-radius:8px;border:1px solid:#334155;background:#0f172a;color:#fff}
button{margin-top:8px;padding:8px 12px;border:none;border-radius:8px;background:#7c3aed;color:#fff;font-weight:700;cursor:pointer}
ul{margin-top:10px;padding-left:18px}
img{border-radius:6px;max-width:100%}
.offer-item{display:flex;align-items:center;gap:10px;margin-bottom:15px;padding:10px;background:#2d3748;border-radius:8px;}
.offer-photo{width:60px;height:60px;object-fit:cover;border-radius:8px;}
.offer-info{flex:1;}
.offer-actions{display:flex;gap:5px;}
.btn-whatsapp{background:#25D366;color:white;}
.photo-preview{width:100px;height:100px;object-fit:cover;border-radius:8px;margin:10px 0;}
.customer-selector{max-height:200px;overflow-y:auto;margin:10px 0;padding:10px;background:#2d3748;border-radius:8px;}
.bill-item{margin-bottom:15px;padding:10px;background:#2d3748;border-radius:8px;}
.appointment-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px;background:#2d3748;border-radius:8px;}
.small{font-size:12px;color:#9aa6bb}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#7c3aed;color:#fff;padding:8px 12px;border-radius:8px;opacity:0;transition:.25s;z-index:999}
.toast.show{opacity:1;bottom:34px}
.feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
.item-card{background:#0f1724;padding:10px;border-radius:8px}
</style>
</head>
<body>
<header>
<div>üíà</div>
<h1>Salon Manager By Salamat Ali</h1>
<div class="pill" id="statusPill">Closed</div>
</header>
<div class="app">
<section id="auth" class="card">
<div class="tabs">
<div class="tab active" data-auth="login">Login</div>
<div class="tab" data-auth="register">Register</div>
<div class="tab" data-auth="forgot">Forgot</div>
</div>
<div id="loginPane">
<label>Username</label><input id="loginUser" type="text" />
<label>Password</label><input id="loginPass" type="password" />
<button id="btnLogin">Login</button>
</div>
<div id="registerPane" class="hidden">
<label>Username</label><input id="regUser" type="text" />
<label>Password</label><input id="regPass" type="password" />
<label>Owner PIN</label><input id="regPin" type="password" maxlength="6" />
<button id="btnRegister">Create Account</button>
</div>
<div id="forgotPane" class="hidden">
<label>Username</label><input id="forgotUser" type="text" />
<label>Owner PIN</label><input id="forgotPin" type="password" maxlength="6" />
<button id="btnForgot">Recover Account</button>
</div>
</section>

<section id="dashboard" class="card hidden">
<div class="tabs" id="mainTabs"></div>
<div id="tabContent"></div>
<button id="btnLogout">Logout</button>
</section>
</div>

<div id="toast" class="toast"></div>

<script>
const $=(s,e=document)=>e.querySelector(s),$$=(s,e=document)=>Array.from((e||document).querySelectorAll(s));
function toast(m){const t=$("#toast");t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1700);}
function getUsersObj(){return JSON.parse(localStorage.getItem("salonUsers")||"{}");}
function saveUsersObj(users){localStorage.setItem("salonUsers",JSON.stringify(users));}
function getCurrentUser(){return localStorage.getItem("currentUser")||"";}
function setCurrentUser(u){if(u) localStorage.setItem("currentUser",u); else localStorage.removeItem("currentUser");}

$$('.tab[data-auth]').forEach(tab=>tab.addEventListener('click',()=>{$$('.tab[data-auth]').forEach(t=>t.classList.remove('active'));tab.classList.add('active');$('#loginPane').classList.toggle('hidden',tab.dataset.auth!=='login');$('#registerPane').classList.toggle('hidden',tab.dataset.auth!=='register');$('#forgotPane').classList.toggle('hidden',tab.dataset.auth!=='forgot');}));

$('#btnRegister').addEventListener('click',()=>{
  const u=$('#regUser').value.trim(),p=$('#regPass').value,pin=$('#regPin').value.trim();
  if(!u||!p||!pin){toast("Fill all fields");return;}
  let users=getUsersObj(); if(users[u]){toast("Username exists");return;}
  users[u]={password:p,pin:pin,data:{apts:[],prods:[],bills:[],history:[],totalSale:0,offers:[]}}; saveUsersObj(users);
  toast("Account created ‚Äî login now"); $('#regUser').value=$('#regPass').value=$('#regPin').value="";
  document.querySelector('[data-auth="login"]').click();
});

$('#btnLogin').addEventListener('click',()=>{
  const u=$('#loginUser').value.trim(),p=$('#loginPass').value; let users=getUsersObj();
  if(users[u]&&users[u].password===p){ setCurrentUser(u); startDashboard(); } else toast("Invalid login");
});

$('#btnForgot').addEventListener('click',()=>{
  const u=$('#forgotUser').value.trim(),pin=$('#forgotPin').value.trim(); let users=getUsersObj();
  if(users[u]&&users[u].pin===pin) toast("Password: "+users[u].password); else toast("Wrong details");
});

$('#btnLogout').addEventListener('click',()=>{
  setCurrentUser(""); $('#dashboard').classList.add("hidden"); $('#auth').classList.remove("hidden"); $('#statusPill').textContent="Closed"; toast('Logged out');
});

const tabs=[{id:"appointments",label:"Appointments"},{id:"billing",label:"Billing"},{id:"products",label:"Products & Services"},{id:"offers",label:"Offers"},{id:"sales",label:"Sales"},{id:"history",label:"History"},{id:"support",label:"Support"}];

function startDashboard(){ $('#auth').classList.add("hidden"); $('#dashboard').classList.remove("hidden"); $('#statusPill').textContent="Open"; checkExpiredOffers(); initTabs(); }

function initTabs(){const bar=$("#mainTabs");bar.innerHTML="";tabs.forEach(t=>{const b=document.createElement("div");b.className="tab";b.textContent=t.label;b.onclick=()=>openTab(t.id);bar.appendChild(b);}); openTab("appointments");}

function openTab(id){ $$("#mainTabs .tab").forEach(b=>b.classList.remove("active")); const idx=tabs.findIndex(t=>t.id===id); $$("#mainTabs .tab")[idx].classList.add("active"); const box=$("#tabContent"); box.innerHTML=""; switch(id){
  case "appointments": renderAppointments(box); break;
  case "billing": renderBilling(box); break;
  case "products": renderProducts(box); break;
  case "offers": checkExpiredOffers(); renderOffers(box); break;
  case "sales": renderSales(box); break;
  case "history": renderHistory(box); break;
  case "support": renderSupport(box); break;
}}

function getUserData(){let users=getUsersObj(); const cur=getCurrentUser(); if(!users[cur]){users[cur]={password:'',pin:'',data:{apts:[],prods:[],bills:[],history:[],totalSale:0,offers:[]}}; saveUsersObj(users);} return users[cur].data;}
function saveUserData(data){let users=getUsersObj(); users[getCurrentUser()].data=data; saveUsersObj(users);}

function renderAppointments(el){let data=getUserData(); if(!data.apts)data.apts=[]; el.innerHTML=`<h3>Book Appointment</h3><label>Name</label><input id="aptName" type="text"><label>Service</label><input id="aptService" type="text"><label>Date & Time</label><input id="aptTime" type="datetime-local"><button id="saveApt">Save</button><ul id="aptList"></ul>`; $("#saveApt").onclick=()=>{const name=$("#aptName").value.trim(),service=$("#aptService").value.trim(),time=$("#aptTime").value; if(!name||!service||!time){toast("Please fill all fields");return;} data.apts.push({name,service,time}); saveUserData(data); openTab("appointments"); toast('Appointment saved');}; $("#aptList").innerHTML=data.apts.length>0?data.apts.map((a,i)=>`<li class="appointment-item"><div><b>${a.name}</b><div class="small">${a.service} at ${a.time}</div></div><button onclick="completeApt(${i})">Complete</button></li>`).join(""):"<li class='small'>No appointments booked yet</li>"; }

function renderBilling(el){let data=getUserData(); if(!data.prods)data.prods=[]; if(!data.bills)data.bills=[]; el.innerHTML=`<h3>Walk-in Billing</h3><label>Customer Name</label><input id="billName" type="text"><label>Phone (WhatsApp)</label><input id="billPhone" type="text"><h4>Select Products/Services</h4><div id="billProducts">${data.prods.length>0?data.prods.map((p,i)=>`<div><input type="checkbox" class="billProd" data-index="${i}" data-price="${p.price}" data-name="${p.name}">${p.name} - $${p.price}</div>`).join(""):"<p class='small'>No products/services added yet. Add them in the Products tab.</p>"}</div><p><b>Total: $<span id="billTotal">0</span></b></p><button id="saveBill" ${data.prods.length===0?'disabled':''}>Save Bill</button><h3>Recent Bills</h3><div id="billList"></div>`; function updateTotal(){let total=0; $$('.billProd:checked').forEach(c=>total+=+c.dataset.price); $('#billTotal').textContent=total;} $$('.billProd').forEach(c=>c.addEventListener('change',updateTotal)); $('#saveBill').onclick=()=>{let selected=[];let total=0; $$('.billProd:checked').forEach(c=>{selected.push({name:c.dataset.name,price:+c.dataset.price}); total+=+c.dataset.price;}); if(!selected.length){toast("Select at least one item");return;} const name=$("#billName").value.trim(), phone=$("#billPhone").value.trim(); if(!name){toast("Please enter customer name");return;} let bill={name,phone,items:selected,amt:total,time:new Date().toLocaleString()}; data.bills.push(bill); data.totalSale=(data.totalSale||0)+bill.amt; saveUserData(data); openTab("billing"); toast('Bill saved'); }; $("#billList").innerHTML=data.bills.length>0?data.bills.map((b,i)=>`<div class="bill-item"><b>${b.name}</b> - $${b.amt}<br><small>${b.time}</small><br><button onclick="printReceipt(${i})">üñ® Print</button> <button onclick="sendWhatsApp(${i})">üì≤ WhatsApp</button></div>`).join(""):"<p class='small'>No bills created yet</p>"; }

window.printReceipt=(index)=>{let data=getUserData(); let b=data.bills[index]; if(!b)return; let itemsHtml=b.items.map(it=>`<li>${it.name} - $${it.price}</li>`).join(""); let w=window.open("","","width=400,height=600"); w.document.write(`<h2>Salon Receipt</h2><p><b>Customer:</b> ${b.name}</p><ul>${itemsHtml}</ul><p><b>Total:</b> $${b.amt}</p><p><b>Date:</b> ${b.time}</p><hr><p>Thank you for visiting!</p>`); w.print(); w.close(); };

window.sendWhatsApp=(index)=>{let data=getUserData(); let b=data.bills[index]; if(!b.phone){toast("No phone number saved");return;} let itemsText=b.items.map(it=>`${it.name} - $${it.price}`).join("%0a"); let msg=`Hello ${b.name},%0aYour bill:%0a${itemsText}%0aTotal: $${b.amt}%0aDate: ${b.time}%0aThank you for visiting our salon!`; let url=`https://wa.me/${b.phone}?text=${encodeURIComponent(msg)}`; window.open(url,"_blank"); };

function renderProducts(el){let data=getUserData(); if(!data.prods)data.prods=[]; el.innerHTML=`<h3>Products & Services</h3><label>Name</label><input id="prodName" type="text"><label>Price</label><input id="prodPrice" type="number"><label>Photo URL (optional)</label><input id="prodPhoto" type="text"><label>Or Upload Photo</label><input id="prodFile" type="file" accept="image/*"><button id="saveProd">Save Product</button><div id="prodList"></div><div class="feed" id="prodFeed"></div>`; let editingIndex=null; $("#saveProd").onclick=()=>{let file=$("#prodFile").files[0]; let name=$("#prodName").value.trim(); let price=+$("#prodPrice").value; let url=$("#prodPhoto").value.trim(); if(!name||!price){toast("Please enter name and price");return;} function saveData(photo){ if(editingIndex!==null){ data.prods[editingIndex]={name,price,photo}; editingIndex=null; } else { data.prods.push({name,price,photo}); } saveUserData(data); openTab("products"); } if(file){ let reader=new FileReader(); reader.onload=e=>saveData(e.target.result); reader.readAsDataURL(file);} else saveData(url||""); }; $("#prodList").innerHTML=data.prods.length>0?data.prods.map((p,i)=>`<div style="margin:6px 0;padding:6px;border:1px solid #333;border-radius:6px;display:flex;align-items:center;gap:10px;">${p.photo?`<img src="${p.photo}" width="50" height="50">`:""}<div style="flex:1">${p.name} - $${p.price}</div><button onclick="editProduct(${i})">‚úèÔ∏è Edit</button><button onclick="deleteProduct(${i})">‚ùå Delete</button></div>`).join(""):"<p class='small'>No products/services added yet</p>"; $("#prodFeed").innerHTML = data.prods.length? data.prods.map(p=>`<div class="item-card"><b>${p.name}</b><div class="small">$${p.price}</div>${p.photo?`<img src="${p.photo}">`:''}</div>`).join('') : ''; window.editProduct=(i)=>{let p=data.prods[i]; $("#prodName").value=p.name; $("#prodPrice").value=p.price; $("#prodPhoto").value=p.photo.startsWith("data:")?"":p.photo; $("#prodFile").value=""; editingIndex=i; }; window.deleteProduct=(i)=>{if(confirm("Delete this product?")){data.prods.splice(i,1); saveUserData(data); openTab("products");}}; }

function renderOffers(el){let data=getUserData(); if(!data.offers)data.offers=[]; if(!data.bills)data.bills=[]; const customers=[]; const cmap={}; data.bills.forEach(b=>{ if(b.name&&b.phone&&!cmap[b.phone]){ cmap[b.phone]=1; customers.push({name:b.name,phone:b.phone}); }}); el.innerHTML=`<h3>Create Special Offers</h3><label>Offer Title</label><input id="offerTitle" type="text"><label>Description</label><input id="offerDesc" type="text"><label>Price</label><input id="offerPrice" type="number"><label>Expiry Date & Time (optional)</label><input id="offerExpiry" type="datetime-local"><label>Upload Offer Photo</label><input id="offerPhoto" type="file" accept="image/*"><img id="offerPreview" class="photo-preview hidden" src="#" alt="Preview"><button id="saveOffer">Save Offer</button><h3>Send Offers to Customers</h3><div class="customer-selector" id="customerSelector">${customers.length>0?customers.map(c=>`<div><input type="checkbox" class="customer-checkbox" data-phone="${c.phone}" data-name="${c.name}">${c.name} (${c.phone})</div>`).join(''):"<p class='small'>No customers found. Create bills to populate customers.</p>"}</div><button id="sendOffers" ${customers.length===0?'disabled':''}>Send Selected Offers via WhatsApp</button><h3>Saved Offers</h3><div id="offerList"></div>`; $("#offerPhoto").addEventListener('change',e=>{const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=ev=>{ $('#offerPreview').src=ev.target.result; $('#offerPreview').classList.remove('hidden'); }; r.readAsDataURL(f); }); $("#saveOffer").onclick=()=>{ const title=$("#offerTitle").value.trim(), desc=$("#offerDesc").value.trim(), price=$("#offerPrice").value, expiry=$("#offerExpiry").value, file=$("#offerPhoto").files[0]; if(!title||!price){toast("Enter title & price");return;} function commit(photo){ data.offers.push({title,desc,price,photo:photo||"",expiry}); saveUserData(data); openTab("offers"); toast('Offer saved'); } if(file){ const r=new FileReader(); r.onload=ev=>commit(ev.target.result); r.readAsDataURL(file); } else commit(''); }; $("#sendOffers").onclick=()=>{ const sel=$$(".customer-checkbox:checked"); if(!sel.length){toast("Select customers");return} if(!data.offers.length){toast("No offers");return} const idx=prompt("Offer index to send (0.."+(data.offers.length-1)+")"); if(idx===null) return; const offer=data.offers[+idx]; if(!offer){toast("Invalid offer");return} sel.forEach(c=>{ const ph=c.dataset.phone, name=c.dataset.name; const msg=`Hello ${name}!%0A${offer.title}%0A${offer.desc?offer.desc+'%0A':''}Price: $${offer.price}`; window.open(`https://wa.me/${ph}?text=${encodeURIComponent(msg)}`,'_blank'); }); toast('Offer(s) sent'); }; $('#offerList').innerHTML = data.offers.length? data.offers.map((o,i)=>`<div class="offer-item">${o.photo?`<img src="${o.photo}" class="offer-photo">`:`<div class="offer-photo" style="background:#7c3aed;display:flex;align-items:center;justify-content:center;color:white">No Image</div>`}<div class="offer-info"><strong>${o.title}</strong><br><small class="small">${o.desc||'No description'}</small><br><small class="small">Price: $${o.price}${o.expiry?` ‚Ä¢ Expires: ${new Date(o.expiry).toLocaleString()}`:''}</small></div><div class="offer-actions"><button class="btn-whatsapp" onclick="sendOfferToAll(${i})">Send to All</button></div></div>`).join('') : "<p class='small'>No offers created yet</p>"; }

window.sendOfferToAll=function(offerIndex){ let data=getUserData(); const offer=data.offers[offerIndex]; const customers=[]; const cmap={}; (data.bills||[]).forEach(b=>{ if(b.name&&b.phone&&!cmap[b.phone]){ cmap[b.phone]=1; customers.push({name:b.name,phone:b.phone}); }}); if(!customers.length){toast("No customers");return} customers.forEach(c=>{ const msg=`Hello ${c.name}!%0A${offer.title}%0A${offer.desc?offer.desc+'%0A':''}Price: $${offer.price}`; window.open(`https://wa.me/${c.phone}?text=${encodeURIComponent(msg)}`,'_blank'); }); toast(`Sent to ${customers.length} customers`); }

function renderSales(el){ let data=getUserData(); let total=data.totalSale||0; el.innerHTML=`<h3>Today's Sales</h3><p>Total: $${total}</p><button id="closeDay">Close Day</button>`; $("#closeDay").onclick=()=>{ if(confirm("Close the day and reset sales?")){ data.history=data.history||[]; data.history.push({date:new Date().toLocaleString(),total:total}); data.totalSale=0; data.bills=[]; saveUserData(data); toast('Day closed'); openTab('sales'); }}; }

function renderHistory(el){ let data=getUserData(); if(!data.history)data.history=[]; el.innerHTML=`<h3>Sales History</h3><ul>${data.history.map(h=>`<li class="small">${h.date}: $${h.total}</li>`).join("")}</ul><label>Password to delete history</label><input id="histPass" type="password"><button id="delHist">Delete History</button>`; $("#delHist").onclick=()=>{ let users=getUsersObj(); let user=users[getCurrentUser()]; if($("#histPass").value===user.pin){ if(confirm("Delete all history?")){ data.history=[]; saveUserData(data); openTab('history'); toast('History deleted'); } } else toast('Wrong PIN'); } }

function renderSupport(el){ el.innerHTML=`<h3>Customer Support</h3><p class="small">Need help? Contact on WhatsApp:</p><button id="btnSupport">üì≤ Chat on WhatsApp</button>`; $("#btnSupport").onclick=()=>{ window.open("https://wa.me/923160045195","_blank"); } }

function checkExpiredOffers(){ let d=getUserData(); if(!d.offers) d.offers=[]; const now=new Date(); const kept=d.offers.filter(o=>!o.expiry||new Date(o.expiry)>now); if(kept.length!==d.offers.length){ d.offers=kept; saveUserData(d); } }

window.completeApt=function(i){ let d=getUserData(); d.apts.splice(i,1); saveUserData(d); openTab('appointments'); toast('Completed'); }

window.onload=()=>{ if(getCurrentUser()){ startDashboard(); } }
</script>
</body>
</html>
