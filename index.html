<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salon Manager</title>

  <!-- CSS -->
  <style>
    body{margin:0;font-family:sans-serif;background:#0b1220;color:#e5e7eb;}
    header{display:flex;align-items:center;gap:10px;padding:10px 16px;background:#111;}
    header h1{margin:0;font-size:18px;font-weight:700}
    .pill{margin-left:auto;padding:4px 10px;background:#7c3aed;border-radius:999px;font-size:12px}
    .app{max-width:700px;margin:30px auto;padding:16px}
    .card{background:#1e293b;padding:20px;border-radius:14px}
    .tabs{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
    .tab{flex:1;padding:10px;border-radius:8px;text-align:center;cursor:pointer;background:#334155}
    .tab.active{background:#7c3aed;color:#fff}
    .hidden{display:none}
    label{font-size:12px;display:block;margin:6px 0}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#0f172a;color:#fff}
    button{margin-top:8px;padding:8px 12px;border:none;border-radius:8px;background:#7c3aed;color:#fff;font-weight:700;cursor:pointer}
    ul{margin-top:10px;padding-left:18px}
    img{border-radius:6px}
  </style>
</head>
<body>
  <header>
    <div>💈</div>
    <h1>Salon Manager</h1>
    <div class="pill" id="statusPill">Closed</div>
  </header>

  <div class="app">
    <!-- AUTH -->
    <section id="auth" class="card">
      <div class="tabs">
        <div class="tab active" data-auth="login">Login</div>
        <div class="tab" data-auth="register">Register</div>
        <div class="tab" data-auth="forgot">Forgot</div>
      </div>

      <!-- Login -->
      <div id="loginPane">
        <label>Username</label><input id="loginUser" type="text" />
        <label>Password</label><input id="loginPass" type="password" />
        <button id="btnLogin">Login</button>
      </div>

      <!-- Register -->
      <div id="registerPane" class="hidden">
        <label>Username</label><input id="regUser" type="text" />
        <label>Password</label><input id="regPass" type="password" />
        <label>Owner PIN</label><input id="regPin" type="password" maxlength="6" />
        <button id="btnRegister">Create Account</button>
      </div>

      <!-- Forgot -->
      <div id="forgotPane" class="hidden">
        <label>Username</label><input id="forgotUser" type="text" />
        <label>Owner PIN</label><input id="forgotPin" type="password" maxlength="6" />
        <button id="btnForgot">Recover Account</button>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" class="card hidden">
      <div class="tabs" id="mainTabs"></div>
      <div id="tabContent"></div>
      <button id="btnLogout">Logout</button>
    </section>
  </div>

  <!-- SCRIPT -->
  <script>
    const $ = (s, el=document)=>el.querySelector(s);
    const $$ = (s, el=document)=>Array.from(el.querySelectorAll(s));

    // ====== STORAGE HELPERS ======
    function getUsersObj(){
      return JSON.parse(localStorage.getItem("salonUsers") || "{}");
    }
    function saveUsersObj(users){
      localStorage.setItem("salonUsers", JSON.stringify(users));
    }
    function getCurrentUser(){
      return localStorage.getItem("currentUser");
    }
    function setCurrentUser(u){
      localStorage.setItem("currentUser", u);
    }

    // ====== AUTH TABS ======
    $$('.tab[data-auth]').forEach(tab=>{
      tab.addEventListener('click', ()=>{
        $$('.tab[data-auth]').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        $('#loginPane').classList.toggle('hidden', tab.dataset.auth!=='login');
        $('#registerPane').classList.toggle('hidden', tab.dataset.auth!=='register');
        $('#forgotPane').classList.toggle('hidden', tab.dataset.auth!=='forgot');
      });
    });

    // ====== REGISTER ======
    $('#btnRegister').addEventListener('click', ()=>{
      const u = $('#regUser').value.trim();
      const p = $('#regPass').value;
      const pin = $('#regPin').value.trim();
      if(!u||!p||!pin){alert("Fill all fields");return;}
      let users = getUsersObj();
      if(users[u]){alert("Username already exists");return;}
      users[u] = {
        password:p,
        pin:pin,
        data:{apts:[],prods:[],bills:[],custs:[],history:[],totalSale:0}
      };
      saveUsersObj(users);
      alert("Account created! Now login.");
      $('#regUser').value=$('#regPass').value=$('#regPin').value="";
      document.querySelector('[data-auth="login"]').click();
    });

    // ====== LOGIN ======
    $('#btnLogin').addEventListener('click', ()=>{
      const u=$('#loginUser').value.trim();
      const p=$('#loginPass').value;
      let users=getUsersObj();
      if(users[u] && users[u].password===p){
        setCurrentUser(u);
        startDashboard();
      } else {
        alert("Invalid login");
      }
    });

    // ====== FORGOT ======
    $('#btnForgot').addEventListener('click', ()=>{
      const u=$('#forgotUser').value.trim();
      const pin=$('#forgotPin').value.trim();
      let users=getUsersObj();
      if(users[u] && users[u].pin===pin){
        alert("Your password is: "+users[u].password);
      } else {
        alert("Wrong details");
      }
    });

    // ====== LOGOUT ======
    $('#btnLogout').addEventListener('click', ()=>{
      $('#dashboard').classList.add("hidden");
      $('#auth').classList.remove("hidden");
      $('#statusPill').textContent="Closed";
      setCurrentUser("");
    });

    // ====== DASHBOARD SYSTEM ======
    const tabs = [
      {id:"appointments", label:"Appointments"},
      {id:"billing", label:"Billing"},
      {id:"products", label:"Products & Services"},
      {id:"customers", label:"Customers"},
      {id:"sales", label:"Sales"},
      {id:"history", label:"History"},
      {id:"support", label:"Support"}
    ];

    function startDashboard(){
      $('#auth').classList.add("hidden");
      $('#dashboard').classList.remove("hidden");
      $('#statusPill').textContent="Open";
      initTabs();
    }

    function initTabs(){
      const bar=$("#mainTabs");
      bar.innerHTML="";
      tabs.forEach(t=>{
        const b=document.createElement("div");
        b.className="tab";
        b.textContent=t.label;
        b.onclick=()=>openTab(t.id);
        bar.appendChild(b);
      });
      openTab("appointments");
    }

    function openTab(id){
      $$("#mainTabs .tab").forEach(b=>b.classList.remove("active"));
      const idx=tabs.findIndex(t=>t.id===id);
      $$("#mainTabs .tab")[idx].classList.add("active");
      const box=$("#tabContent");
      box.innerHTML="";
      switch(id){
        case "appointments": renderAppointments(box); break;
        case "billing": renderBilling(box); break;
        case "products": renderProducts(box); break;
        case "customers": renderCustomers(box); break;
        case "sales": renderSales(box); break;
        case "history": renderHistory(box); break;
        case "support": renderSupport(box); break;
      }
    }

    function getUserData(){
      let users=getUsersObj();
      return users[getCurrentUser()].data;
    }
    function saveUserData(data){
      let users=getUsersObj();
      users[getCurrentUser()].data=data;
      saveUsersObj(users);
    }

    // ====== APPOINTMENTS ======
    function renderAppointments(el){
      let data=getUserData();
      el.innerHTML=`
        <h3>Book Appointment</h3>
        <label>Name</label><input id="aptName" type="text">
        <label>Service</label><input id="aptService" type="text">
        <label>Date & Time</label><input id="aptTime" type="datetime-local">
        <button id="saveApt">Save</button>
        <ul id="aptList"></ul>
      `;
      $("#saveApt").onclick=()=>{
        data.apts.push({name:$("#aptName").value,service:$("#aptService").value,time:$("#aptTime").value});
        saveUserData(data);
        openTab("appointments");
      };
      $("#aptList").innerHTML=data.apts.map(a=>`<li>${a.name} - ${a.service} at ${a.time}</li>`).join("");
    }

    // ====== BILLING ======
    function renderBilling(el){
      let data=getUserData();
      let prods=data.prods||[];
      el.innerHTML=`
        <h3>Walk-in Billing</h3>
        <label>Customer</label><input id="billName" type="text">
        <label>Phone (WhatsApp)</label><input id="billPhone" type="text">
        <h4>Select Products/Services</h4>
        <div id="billProducts">
          ${prods.map((p,i)=>`
            <div>
              <input type="checkbox" class="billProd" data-index="${i}" data-price="${p.price}" data-name="${p.name}">
              ${p.name} - $${p.price}
            </div>
          `).join("")}
        </div>
        <p><b>Total: $<span id="billTotal">0</span></b></p>
        <button id="saveBill">Save Bill</button>
        <ul id="billList"></ul>
      `;
      function updateTotal(){
        let total=0;
        $$(".billProd:checked").forEach(c=>total+=+c.dataset.price);
        $("#billTotal").textContent=total;
      }
      $$(".billProd").forEach(c=>c.addEventListener("change", updateTotal));
      $("#saveBill").onclick=()=>{
        let selected=[]; let total=0;
        $$(".billProd:checked").forEach(c=>{
          selected.push({name:c.dataset.name,price:+c.dataset.price});
          total+=+c.dataset.price;
        });
        if(!selected.length){alert("Select at least one item");return;}
        let bill={name:$("#billName").value,phone:$("#billPhone").value,items:selected,amt:total,time:new Date().toLocaleString()};
        data.bills.push(bill);
        data.totalSale=(data.totalSale||0)+bill.amt;
        saveUserData(data);
        openTab("billing");
      };
      $("#billList").innerHTML=data.bills.map((b,i)=>`
        <li>
          <b>${b.name}</b> - $${b.amt}<br>
          <small>${b.time}</small><br>
          <button onclick="printReceipt(${i})">🖨 Print</button>
          <button onclick="sendWhatsApp(${i})">📲 WhatsApp</button>
        </li>
      `).join("");
    }
    window.printReceipt=(index)=>{
      let data=getUserData();
      let b=data.bills[index];
      let itemsHtml=b.items.map(it=>`<li>${it.name} - $${it.price}</li>`).join("");
      let w=window.open("","","width=400,height=600");
      w.document.write(`<h2>Salon Receipt</h2><p><b>Customer:</b> ${b.name}</p><ul>${itemsHtml}</ul><p><b>Total:</b> $${b.amt}</p><p><b>Date:</b> ${b.time}</p><hr><p>Thank you for visiting!</p>`);
      w.print();w.close();
    };
    window.sendWhatsApp=(index)=>{
      let data=getUserData();let b=data.bills[index];
      if(!b.phone){alert("No phone number saved");return;}
      let itemsText=b.items.map(it=>`${it.name} - $${it.price}`).join("%0a");
      let msg=`Hello ${b.name},%0aYour bill:%0a${itemsText}%0aTotal: $${b.amt}%0aDate: ${b.time}%0aThank you for visiting our salon!`;
      let url=`https://wa.me/${b.phone}?text=${msg}`;
      window.open(url,"_blank");
    };

    // ====== PRODUCTS ======
    function renderProducts(el){
      let data=getUserData();
      el.innerHTML=`
        <h3>Products & Services</h3>
        <label>Name</label><input id="prodName" type="text">
        <label>Price</label><input id="prodPrice" type="number">
        <label>Photo URL (optional)</label><input id="prodPhoto" type="text">
        <label>Or Upload Photo</label><input id="prodFile" type="file" accept="image/*">
        <button id="saveProd">Save Product</button>
        <div id="prodList"></div>
      `;
      let editingIndex=null;
      $("#saveProd").onclick=()=>{
        let file=$("#prodFile").files[0];
        let name=$("#prodName").value;
        let price=+$("#prodPrice").value;
        let url=$("#prodPhoto").value;
        function saveData(photo){
          if(editingIndex!==null){data.prods[editingIndex]={name,price,photo};editingIndex=null;}
          else{data.prods.push({name,price,photo});}
          saveUserData(data);openTab("products");
        }
        if(file){let reader=new FileReader();reader.onload=e=>saveData(e.target.result);reader.readAsDataURL(file);}
        else{saveData(url);}
      };
      $("#prodList").innerHTML=data.prods.map((p,i)=>`
        <div style="margin:6px 0;padding:6px;border:1px solid #333;border-radius:6px;display:flex;align-items:center;gap:10px;">
          <img src="${p.photo}" width="50" height="50"> 
          <div style="flex:1">${p.name} - $${p.price}</div>
          <button onclick="editProduct(${i})">✏️ Edit</button>
          <button onclick="deleteProduct(${i})">❌ Delete</button>
        </div>
      `).join("");
      window.editProduct=(i)=>{let p=data.prods[i];$("#prodName").value=p.name;$("#prodPrice").value=p.price;$("#prodPhoto").value=p.photo.startsWith("data:")?"":p.photo;$("#prodFile").value="";editingIndex=i;};
      window.deleteProduct=(i)=>{data.prods.splice(i,1);saveUserData(data);openTab("products");};
    }

    // ====== CUSTOMERS ======
    function renderCustomers(el){
      let data=getUserData();
      el.innerHTML=`
        <h3>Save Customer Info</h3>
        <label>Name</label><input id="custName" type="text">
        <label>Phone</label><input id="custPhone" type="text">
        <button id="saveCust">Save Customer</button>
        <ul id="custList"></ul>
      `;
      $("#saveCust").onclick=()=>{data.custs.push({name:$("#custName").value,phone:$("#custPhone").value});saveUserData(data);openTab("customers");};
      $("#custList").innerHTML=data.custs.map(c=>`<li>${c.name} (${c.phone})</li>`).join("");
    }

    // ====== SALES ======
    function renderSales(el){
      let data=getUserData();let total=data.totalSale||0;
      el.innerHTML=`<h3>Today's Sales</h3><p>Total: $${total}</p><button id="closeDay">Close Day</button>`;
      $("#closeDay").onclick=()=>{data.history.push({date:new Date().toLocaleString(),total});data.totalSale=0;data.bills=[];saveUserData(data);alert("Day closed. Data saved to history.");openTab("sales");};
    }

    // ====== HISTORY ======
    function renderHistory(el){
      let data=getUserData();
      el.innerHTML=`<h3>Sales History</h3><ul>${data.history.map(h=>`<li>${h.date}: $${h.total}</li>`).join("")}</ul><label>Password to delete history</label><input id="histPass" type="password"><button id="delHist">Delete History</button>`;
      $("#delHist").onclick=()=>{let users=getUsersObj();let user=users[getCurrentUser()];if($("#histPass").value===user.pin){data.history=[];saveUserData(data);openTab("history");}else{alert("Wrong PIN");}};
    }

    // ====== SUPPORT ======
    function renderSupport(el){
      el.innerHTML=`<h3>Customer Support</h3><p>Need help? Contact us on WhatsApp:</p><button id="btnSupport">📲 Chat on WhatsApp</button>`;
      $("#btnSupport").onclick=()=>{window.open("https://wa.me/923160045195","_blank");};
    }
  </script>
</body>
</html>
