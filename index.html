<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Salon Management System</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    header { background: #333; color: #fff; padding: 15px; text-align: center; }
    nav { background: #444; padding: 10px; display: flex; justify-content: space-around; }
    nav button { padding: 10px; background: #666; border: none; color: white; cursor: pointer; }
    nav button:hover { background: #888; }
    section { padding: 20px; display: none; }
    section.active { display: block; background: white; margin: 15px; border-radius: 8px; box-shadow: 0 0 10px #aaa; }
    input, select { padding: 8px; margin: 5px; width: 250px; }
    button.action { padding: 8px 15px; margin: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

<header>
  <h1>Salon Management System</h1>
</header>

<nav>
  <button onclick="showTab('auth')">Login</button>
  <button onclick="showTab('appointments')">Appointments</button>
  <button onclick="showTab('products')">Products</button>
  <button onclick="showTab('billing')">Billing</button>
  <button onclick="showTab('offers')">Offers</button>
  <button onclick="showTab('sales')">Sales</button>
  <button onclick="showTab('history')">History</button>
</nav>

<!-- Authentication -->
<section id="auth" class="active">
  <h2>Authentication</h2>
  <input id="regUser" placeholder="Username"><br>
  <input id="regPass" type="password" placeholder="Password"><br>
  <input id="regPin" placeholder="Owner Pin"><br>
  <button class="action" onclick="registerUser()">Register</button><br><br>

  <input id="logUser" placeholder="Username"><br>
  <input id="logPass" type="password" placeholder="Password"><br>
  <button class="action" onclick="loginUser()">Login</button><br><br>

  <h3>Forgot Password</h3>
  <input id="fpUser" placeholder="Username"><br>
  <input id="fpPin" placeholder="Owner Pin"><br>
  <button class="action" onclick="forgotPassword()">Reset Password</button>
</section>

<!-- Appointments -->
<section id="appointments">
  <h2>Appointments</h2>
  <input id="custName" placeholder="Customer Name">
  <input id="service" placeholder="Service">
  <input id="apptDate" type="date">
  <input id="apptTime" type="time">
  <button class="action" onclick="addAppointment()">Add</button>
  <table id="apptTable">
    <tr><th>Customer</th><th>Service</th><th>Date</th><th>Time</th><th>Action</th></tr>
  </table>
</section>

<!-- Products -->
<section id="products">
  <h2>Products & Services</h2>
  <input id="prodName" placeholder="Product/Service Name">
  <input id="prodPrice" type="number" placeholder="Price">
  <button class="action" onclick="addProduct()">Add</button>
  <table id="prodTable">
    <tr><th>Name</th><th>Price</th><th>Action</th></tr>
  </table>
</section>

<!-- Billing -->
<section id="billing">
  <h2>Billing</h2>
  <select id="billProd"></select>
  <input id="billQty" type="number" placeholder="Qty">
  <button class="action" onclick="addBillItem()">Add Item</button>
  <table id="billTable">
    <tr><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr>
  </table>
  <h3>Total: <span id="billTotal">0</span></h3>
  <button class="action" onclick="saveBill()">Save Bill</button>
</section>

<!-- Offers -->
<section id="offers">
  <h2>Offers</h2>
  <input id="offerTitle" placeholder="Offer Title">
  <input id="offerDisc" type="number" placeholder="Discount %">
  <button class="action" onclick="addOffer()">Add</button>
  <table id="offerTable">
    <tr><th>Title</th><th>Discount</th><th>Action</th></tr>
  </table>
</section>

<!-- Sales -->
<section id="sales">
  <h2>Sales Report</h2>
  <h3>Total Sales: <span id="totalSales">0</span></h3>
</section>

<!-- History -->
<section id="history">
  <h2>History</h2>
  <table id="histTable">
    <tr><th>Customer</th><th>Items</th><th>Total</th><th>Date</th></tr>
  </table>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, collection, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBBFGIwiuzXNFrJ7kRe1rNauKqolIVMVI4",
    authDomain: "upsm-107f6.firebaseapp.com",
    projectId: "upsm-107f6",
    storageBucket: "upsm-107f6.firebasestorage.app",
    messagingSenderId: "359645965485",
    appId: "1:359645965485:web:a8358f7316cc433b182a24",
    measurementId: "G-QYS5PB1C6Y"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;
  let billItems = [];

  // Navigation
  window.showTab = function(id) {
    document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  // Register
  window.registerUser = async function() {
    let u = regUser.value, p = regPass.value, pin = regPin.value;
    await setDoc(doc(db, "users", u), { password: p, pin: pin, appointments:[], products:[], bills:[], offers:[], totalSales:0, history:[] });
    alert("Registered!");
  }

  // Login
  window.loginUser = async function() {
    let u = logUser.value, p = logPass.value;
    let snap = await getDoc(doc(db, "users", u));
    if(snap.exists() && snap.data().password === p){ currentUser = u; alert("Welcome "+u); }
    else alert("Invalid login");
  }

  // Forgot Password
  window.forgotPassword = async function(){
    let u = fpUser.value, pin = fpPin.value;
    let snap = await getDoc(doc(db,"users",u));
    if(snap.exists() && snap.data().pin === pin) alert("Password: "+snap.data().password);
    else alert("Wrong Pin!");
  }

  // Add Appointment
  window.addAppointment = async function(){
    if(!currentUser) return alert("Login first");
    let appt = { customer:custName.value, service:service.value, date:apptDate.value, time:apptTime.value };
    await updateDoc(doc(db,"users",currentUser), { appointments: arrayUnion(appt) });
    let row = apptTable.insertRow(-1);
    row.innerHTML = `<td>${appt.customer}</td><td>${appt.service}</td><td>${appt.date}</td><td>${appt.time}</td><td>✔</td>`;
  }

  // Add Product
  window.addProduct = async function(){
    if(!currentUser) return alert("Login first");
    let prod = { name:prodName.value, price:+prodPrice.value };
    await updateDoc(doc(db,"users",currentUser), { products: arrayUnion(prod) });
    let row = prodTable.insertRow(-1);
    row.innerHTML = `<td>${prod.name}</td><td>${prod.price}</td><td>✔</td>`;
    let opt = document.createElement("option");
    opt.text = prod.name+" - "+prod.price; billProd.add(opt);
  }

  // Add Bill Item
  window.addBillItem = function(){
    let prod = billProd.value, qty = +billQty.value;
    if(!prod || qty<=0) return;
    let [name, price] = prod.split(" - ");
    let total = qty*+price;
    billItems.push({name, qty, price:+price, total});
    let row = billTable.insertRow(-1);
    row.innerHTML = `<td>${name}</td><td>${qty}</td><td>${price}</td><td>${total}</td>`;
    billTotal.innerText = billItems.reduce((s,i)=>s+i.total,0);
  }

  // Save Bill
  window.saveBill = async function(){
    if(!currentUser) return alert("Login first");
    let bill = { items:billItems, total: billItems.reduce((s,i)=>s+i.total,0), date:new Date().toLocaleString() };
    await updateDoc(doc(db,"users",currentUser), { bills: arrayUnion(bill), history: arrayUnion(bill), totalSales: bill.total });
    alert("Bill saved!");
    totalSales.innerText = bill.total;
    let row = histTable.insertRow(-1);
    row.innerHTML = `<td>Customer</td><td>${bill.items.length}</td><td>${bill.total}</td><td>${bill.date}</td>`;
    billItems = []; billTable.innerHTML="<tr><th>Product</th><th>Qty</th><th>Price</th><th>Total</th></tr>";
    billTotal.innerText="0";
  }

  // Add Offer
  window.addOffer = async function(){
    if(!currentUser) return alert("Login first");
    let offer = { title:offerTitle.value, discount:+offerDisc.value };
    await updateDoc(doc(db,"users",currentUser), { offers: arrayUnion(offer) });
    let row = offerTable.insertRow(-1);
    row.innerHTML = `<td>${offer.title}</td><td>${offer.discount}%</td><td>✔</td>`;
  }
</script>
</body>
</html>
